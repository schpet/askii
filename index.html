<!doctype html>
<html>
  <head>
    <title>Ski Free</title>
		<style>
			body { margin: 0px; }
			#skier { color: red; }
			#controls { top: 0px; position: fixed; height: 50px; background: #eee; width: 100%; border-bottom: 3px solid gray; padding: 10px; }
#controls button { height: 40px; width: 100px; }
			#skipre { margin: 0 auto; }
		</style>
<!-- 
Notes
=====

http://nokarma.org/2011/02/02/javascript-game-development-the-game-loop/index.html

http://stackoverflow.com/questions/7539216/


           ..
            ..O
             -|-
              \\

                 ..
                ..
              O..
             -|-
             //
            
              \\
              -|-
               O

              O
             ~|~
              X
             / \



             ::::
    
    \   \
     \_  \_ 
      ;;;;;       

-->

    
  </head>
  <body>
	<div id="controls">
    <button id="left">Left</button>
    <button id="right">Right</button>
    <button id="stop">Stop</button>
	</div>
<pre id="skipre">


################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
#########################lllllll################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
#############################################     ##############################
#############################################     ##############################
#############################################     ##############################
#############################################     ##############################
#############################################     ##############################
#############################################     ##############################
#############################################     ##############################
#############################################     ##############################
#############################################     ##############################
#############################################     ##############################
#############################################     ##############################
#####XXXXXXX#################################     ##############################
#####XXXXXXX#################################     ##############################
#####XXXXXXX####################################################################
#####XXXXXXX####################################################################
#####XXXXXXX####################################################################
#####XXXXXXX####################################################################
#####XXXXXXX####################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
###########??###################################################################
###########??###################################################################
###########??###################################################################
###########??###################################################################
###########??###################################################################
###########??###################################################################
###########??###################################################################
###########??###################################################################
###########??###################################################################
###########??###################################################################
###########??###################################################################
###########??###################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
###################################           ##################################
###################################           ##################################
###################################           ##################################
###################################           ##################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
#######################################~~~~~~~~~~~~#############################
#######################################~~~~~~~~~~~~#############################
#######################################~~~~~~~~~~~~#############################
#######################################~~~~~~~~~~~~#############################
#######################################~~~~~~~~~~~~#############################
#######################################~~~~~~~~~~~~#############################
#######################################~~~~~~~~~~~~#############################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
##########..........############################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
</pre>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script src="shortcut.js"></script>
    <script type="text/javascript">
      $(document).ready(function(){
        function Skier(){
          this.x = 0;
          this.height = 3;
          this.width = 5;

          this.states = {
            'right': [
                      "..O  ", 
                      " -|- ",
                      "  \\\\ "
                    ],
            'left': [
                      "  O..",
                      " -|- ",
                      " //  "
                     ]
          };

          this.state = this.states['right'];

          this.turnLeft = function(){
            this.state = this.states['left'];
          }
          this.turnRight = function(){
            this.state = this.states['right'];
          }

					this.stepForward = function(){
						if(this.state == this.states['left'])
							this.x--;
						else if(this.state == this.states['right'])
							this.x++;
					}
        }

        function Game(){
          this.position = 3;
          this.map = undefined;
          this.skier = undefined;
          this.hook = undefined;

          this.stepForward = function(){
            this.position++;
						this.skier.stepForward();
            console.log("stepped forward " );
          }

          this.render = function(){


            var output = "";
						var affectedlines = []
						
						for(var i = 0; i < this.skier.height; i++){
							affectedlines[i] = this.position + i;
						}

            var i = 0;
            var lineNum = 0;
            while(i < this.map.length){
              var j = this.map.indexOf("\n", i);
              if(j == -1){
                j = this.map.length;
              }

              line = this.map.substr(i, j - i);

							var state = $.inArray(lineNum, affectedlines)

              if(state != -1){
                output += line.substr(0, this.skier.x);
                output += '<span id="skier">';
                output += this.skier.state[state];
                output += '</span>';
                output += line.substr(this.skier.x + this.skier.width);
                output += "\n";
              } else {
                output += line + "\n";
              }

              i = j + 1;
              lineNum++;
            }

            this.hook.html(output);

						$(document).scrollTop($('#skier').position().top - 100);
          }

        }
        
        var breh = new Skier();
        console.log(breh);
        var game = new Game();

        game.skier = breh;

        game.map = $('#skipre').text();
        game.hook = $('#skipre');
        console.log(game);

				var fps = 27;
				var intervalId = undefined;
				game.run = function(){
					intervalId = setInterval(function(){
						game.render();
						game.stepForward();
					}, 1000 / fps);
				};

				game.run();


        $('#left').click(function(){
					game.skier.turnLeft();
        });
				shortcut.add("a",function() {
					game.skier.turnLeft();
				});
        $('#right').click(function(){
					game.skier.turnRight();
        });
				shortcut.add("d",function() {
					game.skier.turnRight();
				});

        $('#forward').click(function(){
            game.render();
            game.stepForward();
        });

        $('#stop').click(function(){
					clearInterval(intervalId);
				});
      });
    </script>
  </body>
</html>
