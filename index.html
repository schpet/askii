<!doctype html>
<html>
  <head>
    <title>Ski Free</title>
		<style type="text/css">
			body { margin: 0px; font-family: monospace; }

			.skier { color: red; }
			#controls { 
				bottom: 0px;
				position: fixed;
				background: #333;
				width: 100%;
				text-align: center;
				padding-top: 10px;
				padding-bottom: 10px;
			}
			#controls button { 
				height: 100px;
				background: #00a6fc;
				display: inline-block;
				text-align: center;
				padding: 9px 24px 11px;
				color: #fff;
				text-decoration: none;
				font-weight: bold;
				line-height: 1;
				position: relative;
				cursor: pointer;
				border: none;
			}
			
			@media only screen and (min-width: 480px) {
				#controls button { height: 50px; }
			}


			#content { text-align: center; }
		</style>
		<meta name="viewport" content="width=device-width, initial-scale=1.0; user-scalable=0;">  
<!-- 

TODO
====
 - smarter render so it works on mobile devices
 - ski trails behind you
 - jumps
 - abominal snowman?

Notes
=====

http://nokarma.org/2011/02/02/javascript-game-development-the-game-loop/index.html

http://stackoverflow.com/questions/7539216/


           ..
            ..O
             -|-
              \\

                 ..
                ..
              O..
             -|-
             //
            
              \\
              -|-
               O

              O
             ~|~
              X
             / \



             ::::
    
    \   \
     \_  \_ 
      ;;;;;       

-->

    
  </head>
  <body>
	<div id="controls">
    <button id="left">Left</button>
    <button id="start">Start</button>
    <button id="stop">Stop</button>
    <button id="right">Right</button>
	</div>
	<div id="content">
<pre id="skipre">

                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                         vvvvv        (((((                     
                                         vvvvv        (((((                     
                                         vvvvv                                  
                                         vvvvv                                  
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                         lllllll                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
     XXXXXXX                                                                    
     XXXXXXX                                                                    
     XXXXXXX                                                                    
     XXXXXXX                                                                    
     XXXXXXX                                                                    
     XXXXXXX                                                                    
     XXXXXXX                                                                    
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
           ??                                                                   
           ??                                                                   
           ??                       -------------------                         
           ??                       -------------------                         
           ??                       -------------------                         
           ??                       -------------------                         
           ??                       -------------------                         
           ??                       -------------------                         
           ??                                                                   
           ??                                                                   
           ??                                                                   
           ??                                                                   
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                       ~~~~~~~~~~~~                             
                                       ~~~~~~~~~~~~                             
                                       ~~~~~~~~~~~~                             
                                       ~~~~~~~~~~~~                             
                                       ~~~~~~~~~~~~                             
                                       ~~~~~~~~~~~~                             
                                       ~~~~~~~~~~~~                             
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                      !!!!      
                                                                      !!!!      
                                                                      !!!!      
                                                                      !!!!      
                                                                      !!!!      
                                                                      !!!!      
                                                                      !!!!      
                                                                      !!!!      
                                                                      !!!!      
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
	</pre>
</div>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script src="shortcut.js"></script>
    <script type="text/javascript">
      $(document).ready(function(){
        function Skier(world){
          this.x = 0;
          this.width = 6;

          this.states = {
            'right': [
                      "..    ", 
                      " ..O  ", 
                      "  -|- ",
                      "   \\\\ "
                    ],
            'left': [
                      "    ..",
                      "  O.. ",
                      " -|-  ",
                      " //   "
                     ]
          };

          this.state = this.states['right'];

          this.turnLeft = function(){
            this.state = this.states['left'];
          }
          this.turnRight = function(){
            this.state = this.states['right'];
          }

					this.stepForward = function(){
						if(this.state == this.states['left'] && this.x > 0)
							this.x--;
						else if(this.state == this.states['right'] && this.x < 80 - this.width)
							this.x++;
					}
        }

				function Map(mapElement){
					this.map = mapElement.text().split("\n");

          this.init = function(){
            mapElement.text("");
            $.each(this.map, function(i, element){
              mapElement.append('<div id="' + i + '">' + element + '</div>');
            });
          }
				}

        function Game(){
					this.cameraPosition = 0;
          this.position = 3;
          this.map = undefined;
          this.skier = undefined;
          this.hook = undefined;
					this.delay = 50;
					this.timeoutId = undefined;

          this.stepForward = function(){
            this.position++;
						this.skier.stepForward();
          };

          this.render = function(){

						var last = false;
						
						// window.scrollTo(0, this.cameraPosition);

						for(var i = 0; i < this.skier.state.length; i++){
              var original = this.map.map[this.position];

              line = original.substr(0, this.skier.x);
              line += '<span class="skier"'; 
              line += (i == 1) ? ' id="skier">': '>';
              line += this.skier.state[i];
              line += '</span>';
              line += original.substr(this.skier.x + this.skier.width);

							$('#' + (this.position + i)).html(line);
						}

						// this.cameraPosition = $('#skier').position().top - 200;
console.log(this.cameraPosition);
          };

					this.run = function(){
						var self = this;
						this.timeoutId = setTimeout(function(){ 
              if(self.position > self.map.map.length - self.skier.state.length)
                self.position = 0;

							self.render(); 
							self.stepForward() 
							self.run();
						}, this.delay);
					};

					this.stop = function(){
						if(this.timeoutId){
							clearTimeout(this.timeoutId);
						}
					};
        };

        
        var breh = new Skier();
        console.log(breh);
        var game = new Game();

        game.skier = breh;

        game.map = new Map($('#skipre'));
        game.map.init();
        game.hook = $('#skipre');
        console.log(game);


        $('#left').click(function(){
					game.skier.turnLeft();
        });
				shortcut.add("a",function() {
					game.skier.turnLeft();
				});
				shortcut.add("left",function() {
					game.skier.turnLeft();
				});
        $('#right').click(function(){
					game.skier.turnRight();
        });
				shortcut.add("d",function() {
					game.skier.turnRight();
				});
				shortcut.add("right",function() {
					game.skier.turnRight();
				});

        $('#stop').click(function(){
					game.stop();
					$('#start').show();
					$('#stop').hide();
				});
				$('#stop').hide();

        $('#start').click(function(){
					game.run();
					$('#start').hide();
					$('#stop').show();
				});
      });

    </script>
  </body>
</html>
